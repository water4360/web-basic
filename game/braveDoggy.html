<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>230512 Hari's peaceful walking</title>
    <script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
    <style>
        @font-face {
            font-family: 'DOSIyagiMedium';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/DOSIyagiMedium.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        * {
            font-family: 'DOSIyagiMedium';
            /* font-size: large; */
        }

        #container {
            position: absolute;
            left: 10px;
            width: 600px;
            height: 300px;
            border: 1px black solid;
            overflow: hidden;
            background-image: url('src/forest.jpg');
            /* background-repeat: repeat; */
            background-size: contain;
        }

        #title {
            position: relative;
            background-color: aliceblue;
            font-size: small;
        }

        #guide {
            position: relative;
            background-color: aliceblue;
            font-size: small;
        }

        #hari {
            position: absolute;
            left: 20px;
            bottom: 40px;
            width: 100px;
            height: 100px;
            border: 1px solid;
        }

        .toEat {
            position: absolute;
            width: 40px;
            height: 40px;
            right: 0px;
            bottom: 40px;
        }

        #bone {
            position: absolute;
            width: 40px;
            height: 40px;
            right: 0px;
            bottom: 160px;
        }

        .toAvoid {
            position: absolute;
            width: 40px;
            height: 40px;
            right: 0px;
            bottom: 40px;
            transform: scaleX(-1);
        }

        #rabbit {
            position: absolute;
            width: 40px;
            height: 40px;
            right: 0px;
            bottom: 40px;
            transform: scaleX(-1);
        }

        #goose {
            position: absolute;
            width: 50px;
            height: 50px;
            right: 0px;
            bottom: 40px;
            transform: scaleX(1);
        }

        #score {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 30px;
            color: aliceblue;
        }

        #gameover_screen {

            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 30px;
            text-align: center;
            line-height: 300px;
            display: none;
            z-index: 100;
        }
    </style>

    <script>
        const TOEAT_SPEED_MIN_EASY = 1000;
        const TOEAT_SPEED_MAX_EASY = 3000;

        const TOEAT_SPEED_MIN_HARD = 500;
        const TOEAT_SPEED_MAX_HARD = 1000;

        $('#gameover_screen input[type="button"]').click(function () {
            $('#gameover_screen').hide(); // 게임 오버 화면 숨김
            gameStart(); // 게임 재시작
        });

        $(function () {
            const hari = $('#hari');
            const toEat = $('.toEat');
            const toAvoid = $('.toAvoid');

            // 점프 중인지?
            let isJumping = false;
            let score = 0;

            gameStart();

            //배경화면 움직이기
            function moveBackground() {
                let position = 0;
                setInterval(function () {
                    $("#container").css("background-position", position-- + "px");
                }, 10);
            }


            //게임 시작시 모든 함수 실행
            function gameStart() {
                $('#gameover_screen').hide();

                setKeyboardEvent();
                objToEat();
                objToAvoid();

                checkGameOver();
                moveBackground()
            }

            //충돌 감지
            function isColliding(el1, el2) {
                const char = el1.getBoundingClientRect();
                // const char = {
                //     bottom: el1.getBoundingClientRect().bottom,
                //     top: el1.getBoundingClientRect().bottom - el1.height() + 20, // 다리와 발 부분만 선택
                //     right: el1.getBoundingClientRect().right - 20, // 다리와 발 부분만 선택
                //     left: el1.getBoundingClientRect().left + 20 // 다리와 발 부분만 선택
                // };

                const obj = el2.getBoundingClientRect();

                return !(
                    char.bottom < obj.top ||
                    char.top > obj.bottom ||
                    char.right < obj.left ||
                    char.left > obj.right
                );
            }

            //copilot 추천
            function checkGameOver() {
                setInterval(function () {
                    const isGameOver = isColliding(hari[0], toEat[0]);
                    if (isGameOver) {
                        hari.stop();
                        toEat.stop();
                        toAvoid.stop();
                        $('#gameover_screen').show();
                    }
                }, 1000 / 60);
            }

            function getRandomNumber(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            function objToEat() {
                // 속도 조절
                const speed = getRandomNumber(1000, 3000);

                // 음식이 오른쪽에서 날아와요
                toEat.animate(
                    { right: '700px' },
                    speed,
                    'linear',
                    function () {
                        // 점수 올리자
                        score += 100;
                        updateScore(score);

                        // 적 리젠
                        toEat.css('right', '-50px');
                        objToEat();
                    });
            }

            //피해야할 장애물
            function objToAvoid() {
                // 속도 조절
                const speed = getRandomNumber(3000, 6000);

                // 장애물이 오른쪽에서 왼쪽으로
                toAvoid.animate(
                    { right: '700px' },
                    speed,
                    'linear',
                    function () {

                        // 닿으면 점수가 깎여요
                        score -= 100;
                        updateScore(score);

                        // 적 리셋
                        toAvoid.css('right', '-50px');
                        objToAvoid();
                    });
            }

            function updateScore(score) {
                $('#score').text(score);
            }

            function jump() {
                isJumping = true;
                hari.animate({ bottom: '+=50px' })
                    .animate({ bottom: '-=50px' }, function () {
                        isJumping = false;
                    });
            }

            // 키보드 이벤트 정의
            function setKeyboardEvent() {

                $('html').keydown(function (e) {
                    switch (e.key) {
                        case 'ArrowLeft':
                            moveLeft();
                            break;
                        case 'ArrowRight':
                            moveRight();
                            break;
                        case ' ': //spacebar
                            if (!isJumping) {
                                jump();
                            }
                            break;
                        // spacebar 입력시 언니호출ㅋㅋ
                        // case ' ':
                        //     callSoob();
                        //     break;
                    }
                    console.log(e.key);
                })

                function moveLeft() {
                    hari.animate({ left: '-=10px' }, 0);
                    if (hari.position().left < 0) {
                        hari.animate({ left: '+=10px' }, 0);
                    }

                    //왼쪽벽에 닿는지
                    const hariLeftMargin = hari.position().left;
                    if (hariLeftMargin < 0) {
                        hari.animate({ left: '+=10px' }, 0);
                    }
                }

                function moveRight() {
                    hari.animate({ left: '+=10px' }, 0);
                    //1번
                    if (hari.position().left > 350) {
                        hari.animate({ left: '-=10px' }, 0);
                    }

                    //오른쪽벽에 닿는지
                    const hariRightMargin = hari.position().left;
                    if (hariRightMargin > container.width() - hari.width()) {
                        hari.animate({ left: '-=10px' }, 0);
                    }
                }
                function jump() {
                    isJumping = true
                    hari.animate({ bottom: '+=60px' })
                        .animate({ bottom: '-=60px' }, function () {
                            isJumping = false
                        }); //합쳐줬음
                }
            }
        });
    </script>
</head>

<body>
    <div id="title">미친 거위를 피해 안전하게 산책을 마치고 언니에게 돌아가도록 도와주세요!</div>
    <div id="container">
        <div class="sliding-background"></div>
        <img id="hari" src="src/walking-hari.gif" alt="">

        <img class="toEat" id="bone" src="src/bone.png" alt="">
        <img class="toAvoid" id="goose" src="src/goose.gif" alt="">

        <div id="gameover_screen">
            <span id="gameover_msg">산책 종료ㅠㅠ</span>
            <input type="button" onclick="window.location.reload();" value="다시하기">
        </div>


        <div id="score">000</div>
        <div id="guide">이동:좌우화살표, 점프:위, 언니소환:spacebar</div>
    </div>
</body>

</html>