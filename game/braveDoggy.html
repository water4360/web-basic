<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>230512 Hari's peaceful walking</title>
  <!-- <script
      src="https://code.jquery.com/jquery-3.6.4.js"
      integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
      crossorigin="anonymous"></script> -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <link rel="stylesheet" href="style.css" />

  <script>
    let container = $("#container");
    let countdown = $("#countdown");

    let hari;
    let friend;
    let food;
    let goose;
    let score;

    //ëª¨ë“  ì˜¤ë¸Œì íŠ¸ê°€ ì¤€ë¹„ë˜ë©´ ë³€ìˆ˜í• ë‹¹&ì‹¤í–‰
    $(document).ready(function () {
      const startButton = $("#startButton");
      // let score = $('#score');
      hari = $("#hari");
      friend = $("#fox");
      food = $(".food");
      goose = $(".toAvoid");
      socre = $("#score");
      countdown = $("#countdown");

      //ì´ˆê¸°í™”ë©´ ì„¸íŒ…
      moveBackground();
      $('#contents').hide();//hari, food, goose, score, countdown í¬í•¨


      //ê²Œì„ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•ˆë‚´ë©”ì„¸ì§€&ë²„íŠ¼ ì‚¬ë¼ì§€ê³  ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘.
      startButton.click(function () {

        $("#startScreen").hide(); // ê²Œì„ ì‹œì‘ í™”ë©´ ìˆ¨ê¹€
        startButton.hide();


        // hari.show();
        // food.show();
        // goose.show();
        // score.show();

        let count = 3;
        countdown.text(count);

        const intervalId = setInterval(() => {
          count--;
          countdown.text(count);
          if (count === 0) {
            clearInterval(intervalId);

            alert("ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
            gameStart();
          }
        }, 1000);





      }); //click í•¨ìˆ˜ ë


      // $(function () {
      // hari = $("#hari");
      // friend = $("#fox");
      // food = $(".food");
      // goose = $(".toAvoid");


      // //ì´ˆê¸°í™”ë©´ ì„¸íŒ…
      // moveBackground();
      // hari.hide();
      // food.hide();
      // goose.hide();
      // score.hide();
      // countdown.hide();

      // ì í”„ ì¤‘ì¸ì§€?
      let isJumping = false;
      // let score = 0;

      //ë°°ê²½í™”ë©´ ì›€ì§ì´ê¸°
      function moveBackground() {
        let position = 0;
        setInterval(function () {
          $("#container").css("background-position", position-- + "px");
        }, 10);
      }

      //ê²Œì„ ì‹œì‘
      // gameStart();

      //ê²Œì„ ì‹œì‘ì‹œ ëª¨ë“  í•¨ìˆ˜ ì‹¤í–‰
      function gameStart() {
        hari.show();
        goose.show();
        food.show();

        setKeyboardEvent();
        objFood();
        objToAvoid();

        checkGameOver();
        checkGameClear();
      }

      //í•˜ë¦¬(ìºë¦­í„°) ë”°ë¼ë‹¤ë‹ˆê¸°
      function followHari() {
        let whereHari = hari.position();
        friend.css({
          left: whereHari.left + 50 + "px",
          bottom: whereHari.bottom + 50 + "px",
        });
        //í‰ì†Œì—” ìˆ¨ì–´ìˆë‹¤ê°€
        // friend.hide();
      }

      setInterval(followHari, 1000 / 60);

      //ìµœì†Œ~ìµœëŒ€ê°’ ëœë¤í•¨ìˆ˜ êµ¬í•˜ê¸°
      function getRandomNumber(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      //ë¨¹ì–´ì•¼ í•  ì˜¤ë¸Œì íŠ¸
      function objFood() {
        // ì†ë„ ì¡°ì ˆ
        const speed = getRandomNumber(2000, 3000);

        // ìŒì‹ì´ ìš°ì¸¡ìœ¼ë¡œë¶€í„° 800pxê¹Œì§€ ì´ë™
        food.animate({ right: "800px" }, speed, "linear", function () {
          // ìŒì‹ ë¦¬í•„
          food.css("right", "-50px");
          objFood();
        });

        //ë¨¹ìœ¼ë©´ ì ìˆ˜ ì¦ê°€
        setInterval(function () {
          if (isColliding(hari[0], food[0])) {
            score += 100;
            updateScore(score);
            food.stop();
            food.css("right", "-50px");
            objFood();
            // hari.stop();
          }
        }, 1000 / 60);

        // if (isColliding(hari[0], food[0])) {
        //     score += 100;
        //     updateScore(score);
        // }
      }

      //í”¼í•´ì•¼í•  ì˜¤ë¸Œì íŠ¸
      function objToAvoid() {
        // ì†ë„ ì¡°ì ˆ
        const speed = getRandomNumber(3000, 5000);

        // ì¥ì• ë¬¼ì´ ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ
        toAvoid.animate({ right: "700px" }, speed, "linear", function () {
          // êµ¬ìŠ¤ ë¦¬ì…‹
          toAvoid.css("right", "-100px");
          objToAvoid();
        });

        let collided = false; //ì¶©ëŒ ì—¬ë¶€ í™•ì¸
        let hasCollidedBefore = false;

        setInterval(function () {
          if (isColliding(hari[0], toAvoid[0])) {
            collided = true;

            //ì²« ì¶©ëŒì¼ë•Œë§Œ ì ìˆ˜ ê°ì†Œ
            if (!hasCollidedBefore) {
              score -= 50;
              updateScore(score);
              hasCollidedBefore = true;
            }
            collided = false;
          }
        }, 1000 / 60);
      }

      //ì ìˆ˜ ë°˜ì˜ + ìƒ‰ë³€ê²½
      function updateScore(score) {
        let currentScore = $("#score");
        currentScore.text(score).prepend("SCORE: ");

        if (currentScore.text() < 0) {
          currentScore.css("color", "red");
        } else {
          currentScore.css("color", "aliceblue");
        }
        return currentScore;
      }

      //ì¶©ëŒ ê°ì§€
      function isColliding(object1, object2) {
        // const char = object1.getBoundingClientRect();
        const char = {
          bottom: object1.getBoundingClientRect().bottom,
          top: object1.getBoundingClientRect().top + 40,
          right: object1.getBoundingClientRect().right - 20, // ë‹¤ë¦¬ì™€ ë°œ ë¶€ë¶„ë§Œ ì„ íƒ
          left: object1.getBoundingClientRect().left + 20, // ë‹¤ë¦¬ì™€ ë°œ ë¶€ë¶„ë§Œ ì„ íƒ
        };

        const obj = object2.getBoundingClientRect();

        return !(
          char.bottom < obj.top ||
          char.top > obj.bottom ||
          char.right < obj.left ||
          char.left > obj.right
        );
      }

      //ì„¤ì •ì ìˆ˜ ë„ë‹¬ì‹œ ê²Œì„í´ë¦¬ì–´
      function checkGameClear() {
        setInterval(function () {
          // console.log(score);
          // console.log(score > 100);
          if (score > 300) {
            alert("ê²Œì„ í´ë¦¬ì–´!");
            // food.fadeOut(3000)
            // toAvoid.fadeOut;

            //í•˜ë¦¬ ì ë“  ì‚¬ì§„, ì‚°ì±… ë!
            // $("#gameclear_screen").show();
          }
        }, 1000 / 60);
      }

      //ê²Œì„ì˜¤ë²„ ì¡°ê±´ ë³€ê²½
      function checkGameOver() {
        const isGameOver = false;
        setInterval(function () {
          if (score === -500) {
            hari.stop();
            food.stop();
            toAvoid.stop();
            $("#gameover_screen").show();
            return (isGameOver = true);
          }
        });
      }

      // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì •ì˜
      function setKeyboardEvent() {
        $("html").keydown(function (e) {
          switch (e.key) {
            case "ArrowLeft":
              moveLeft();
              break;
            case "ArrowRight":
              moveRight();
              break;
            case "ArrowUp": //spacebar
              if (!isJumping) {
                jump();
              }
              break;
            // spacebar ì…ë ¥ì‹œ ì¹œêµ¬í˜¸ì¶œã…‹ã…‹
            case " ":
              callFriend();
              break;
          }
          console.log(e.key);
        });

        function moveLeft() {
          hari.animate({ left: "-=10px" }, 0);
          if (hari.position().left < 0) {
            hari.animate({ left: "+=10px" }, 0);
          }
          //ì™¼ìª½ë²½ì— ë‹¿ëŠ”ì§€
          const hariLeftMargin = hari.position().left;
          if (hariLeftMargin < 0) {
            hari.animate({ left: "+=10px" }, 0);
          }
        }
        function moveRight() {
          hari.animate({ left: "+=10px" }, 0);
          //1ë²ˆ
          if (hari.position().left > 350) {
            hari.animate({ left: "-=10px" }, 0);
          }
          //ì˜¤ë¥¸ìª½ í•œê³„
          const hariRightMargin = hari.position().left;
          if (hariRightMargin > container.width() - hari.width()) {
            hari.animate({ left: "-=10px" }, 0);
          }
        }
        function jump() {
          isJumping = true;
          hari
            .animate({ bottom: "+=80px" }, 500)
            .animate({ bottom: "-=80px" }, 500, function () {
              isJumping = false;
            }); //í•©ì³ì¤¬ìŒ
        }

        // í•„ì‚´ê¸°, ì¹œêµ¬ ë¶€ë¥´ê¸°
        function callFriend() {
          friend = $("#fox");
          friend.show();
          friend.animate(
            { left: "600px" },
            //ìˆ«ì ë‚®ìœ¼ë©´ ë¹ ë¥´ê³ , ë†’ìœ¼ë©´ ëŠë ¤ì§
            1000,
            "linear",
            function () {
              //ê±°ìœ„ ë¬¼ë¦¬ì¹˜ê³ 
              goose.hide();
              // killGoose();
              //ì‚¬ë¼ì§€ê¸°
              friend.show();
              friend.css(defaultPosition);
              goose.show();
            }
          );
        }
        const fox = document.querySelector("#fox");
        const goose = document.querySelector("#goose");

        //ì—¬ìš°ì˜ ê±°ìœ„ì¡ê¸°
        function killGoose() {
          const foxRect = fox.getBoundingClientRect();
          const gooseRect = goose.getBoundingClientRect();

          if (foxRect.x + foxRect.width > gooseRect.x) {
            fox.hide();
            goose.hide();
          }
        }

        setInterval(killGoose, 1000 / 60);
      }
      // });





    }); //ready í•¨ìˆ˜ ë

    $('#gameover_screen input[type="button"]').click(function () {
      $("#gameover_screen").hide(); // ê²Œì„ ì˜¤ë²„ í™”ë©´ ìˆ¨ê¹€
      gameStart(); // ê²Œì„ ì¬ì‹œì‘
    });

    //ë¬´ì¡°ê±´ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜

  </script>
</head>

<body>
  <!-- <span id="title">í•˜ë¦¬ì˜ ì‚°ì±…</span> -->
  <!-- <span id="title"
      >í•˜ë¦¬ê°€ ë¯¸ì¹œ ê±°ìœ„ë¥¼ í”¼í•´ <br />
      ì•ˆì „í•˜ê²Œ ì‚°ì±…ì„ ë§ˆì¹˜ê³  <br />ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”!</span
    > -->
  <div id="container">
    <div id="intro">
      <div id="startScreen">
        <span id="titleName">í•˜ë¦¬ì˜ í‰í™”ë¡œìš´ ì‚°ì±…</span>
        <span id="titleEngName">Hari's peaceful walk</span>

        <span id="titleText">
          ëª©í‘œì ìˆ˜ 1000ì ì„ ëª¨ì•„ì„œ <br />
          í•˜ë¦¬ğŸ•ê°€ ì´ìƒí•œ ê±°ìœ„ğŸ”ªë¥¼ í”¼í•´ <br />
          ì§‘ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”! <br />
        </span>
        <button id="startButton" onclick="clickButton()">P L A Y</button>
      </div>
      <div id="countdown">3</div>
    </div>


    <div id="contents">
      <div>
        <img id="hari" src="src/walking-hari.gif" alt="" />
        <img class="friend" id="fox" src="src/fox.gif" alt="" />
      </div>

      <img class="food" id="bone" src="src/bone.png" alt="" />
      <img class="toAvoid" id="goose" src="src/goose.gif" alt="" />
      <div id="score">score : 000</div>
    </div>


    <div id="gameover_screen">
      <span id="gameover_msg">ì‚°ì±… ì¢…ë£Œã… ã… </span>
      <input type="button" onclick="window.location.reload();" value="ë‹¤ì‹œí•˜ê¸°" />
    </div>

    <div id="guide">
      ì´ë™ : â—€ â–¶&nbsp&nbsp&nbspì í”„ : â–²&nbsp&nbsp&nbspì¹œêµ¬ë¶€ë¥´ê¸° : spacebar
    </div>
  </div>
</body>

</html>