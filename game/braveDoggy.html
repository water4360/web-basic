<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í•˜ë¦¬ì˜ ì‚°ì±…</title>
  <!-- <script
      src="https://code.jquery.com/jquery-3.6.4.js"
      integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
      crossorigin="anonymous"></script> -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <link rel="stylesheet" href="style.css" />

  <script>
    let container = $("#container");
    let countdown = $("#countdown");


    let hari;
    let bunny;
    let food;
    let goose;
    // let score = $("#score");

    //ëª¨ë“  ì˜¤ë¸Œì íŠ¸ê°€ ì¤€ë¹„ë˜ë©´ ë³€ìˆ˜í• ë‹¹&ì‹¤í–‰
    $(document).ready(function () {
      const startButton = $("#startButton");
      let contents = $("#contents");

      hari = $("#hari");
      bunny = $("#rabbit");
      // food = $(".food");
      food = $(".food");
      goose = $(".toAvoid");
      countdown = $("#countdown");

      //ì´ˆê¸°í™”ë©´ ì„¸íŒ…
      // moveBackground();
      contents.hide();//hari, food, goose, score, countdown í¬í•¨
      countdown.hide();

      //ë°°ê²½í™”ë©´ ì›€ì§ì´ê¸°
      // function moveBackground() {
      let position = 0;
      setInterval(function () {
        $("#container").css("background-position", position-- + "px");
      }, 20);
      // }

      ////////////ê²Œì„ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•ˆë‚´ë©”ì„¸ì§€&ë²„íŠ¼ ì‚¬ë¼ì§€ê³ 
      startButton.click(function () {

        $("#startScreen").hide();
        startButton.hide();
        countStart();

      }); //click í•¨ìˆ˜ ë



      ///////////countstart ëë‚˜ë©´ gameStart
      function countStart() {
        // 3ë¶€í„° countdown
        countdown.show();
        let count = 3;
        countdown.text(count);

        setInterval(() => {
          count--;
          countdown.text(count);
          if (count === 0) {
            clearInterval(this)
            // alert("ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
            countdown.hide();
            gameStart();
          }
        }, 1000);
      }

      //ê²Œì„ ì‹œì‘(ì„ì‹œ í™•ì¸ìš©)
      gameStart();
      $("#startScreen").hide();


      ///////////////ê²Œì„ ì‹œì‘ì‹œ ëª¨ë“  í•¨ìˆ˜ ì‹¤í–‰
      function gameStart() {


        contents.show();



        setKeyboardEvent();
        objFood();
        objToAvoid();

        checkGameOver();
        checkGameClear();

        $('#gameover_screen').hide();
      }

      /////////////í•˜ë¦¬(ìºë¦­í„°) ë”°ë¼ë‹¤ë‹ˆê¸°
      function followHari() {
        let whereHari = hari.position();
        bunny.css({
          left: whereHari.left + -20 + "px",
          top: whereHari.top + 70 + "px",
        });
      }
      setInterval(followHari, 1000 / 60);


      //ìµœì†Œ~ìµœëŒ€ê°’ ëœë¤í•¨ìˆ˜ êµ¬í•˜ê¸°
      function getRandomNumber(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      //ì—¬ê¸°ì„œë¶€í„° scoreëŠ” ë‹¤ì‹œ ë„˜ë²„
      let score = 0;

      /////////////////////////ë¨¹ì–´ì•¼ í•  ì˜¤ë¸Œì íŠ¸
      function objFood() {
        // const food = $("#yammy");
        // ì†ë„ ì¡°ì ˆ
        const speed = getRandomNumber(2000, 3000);

        
        // ìŒì‹ì´ ìš°ì¸¡ìœ¼ë¡œë¶€í„° 800pxê¹Œì§€ ì´ë™
        food.animate({ right: "800px" }, speed, "linear", function () {
          // ìŒì‹ ë¦¬í•„
          food.css("right", "-50px");
          objFood();
        });

        //ë¨¹ìœ¼ë©´ ì ìˆ˜ ì¦ê°€
        setInterval(function () {
          if (isColliding(hari[0], food[0])) {
            score += 100;
            updateScore(score);
            food.stop();
            food.css("right", "-50px");
            objFood();
            // hari.stop();
          }
        }, 1000 / 60);

      }

      //////////////////////í”¼í•´ì•¼í•  ì˜¤ë¸Œì íŠ¸
      function objToAvoid() {
        // ì†ë„ ì¡°ì ˆ
        const speed = getRandomNumber(4000, 5000);

        // ì¥ì• ë¬¼ì´ ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ
        goose.animate({ right: "800px" }, speed, "linear", function () {
          // êµ¬ìŠ¤ ë¦¬ì…‹
          goose.css("right", "-300px");
          objToAvoid();
        });

        let collided = false; //ì¶©ëŒ ì—¬ë¶€ í™•ì¸
        let hasCollidedBefore = false;

        setInterval(function () {
          if (isColliding(hari[0], goose[0])) {
            collided = true;

            //ì²« ì¶©ëŒì¼ë•Œë§Œ ì ìˆ˜ ê°ì†Œ
            if (!hasCollidedBefore) {
              score -= 100;
              updateScore(score);
              hasCollidedBefore = true;
            }
            collided = false;
          }
        }, 1000 / 60);
      }






      //ì ìˆ˜ ë°˜ì˜ + ìƒ‰ë³€ê²½
      function updateScore(score) {
        let currentScore = $("#score");
        currentScore.text(score).append("ì ");

        if (parseInt(currentScore.text()) < 0) {
          currentScore.css("color", "red");
        } else {
          currentScore.css("color", "aliceblue");
        }
      }






      //ì¶©ëŒ ê°ì§€
      //í•˜ë¦¬ì „ìš©
      function isColliding(object1, object2) {
        // const char = object1.getBoundingClientRect();
        const char = {
          //230513 22:03 1ì°¨ ìˆ˜ì •
          bottom: object1.getBoundingClientRect().bottom,
          top: object1.getBoundingClientRect().top + 40,
          right: object1.getBoundingClientRect().right - 20,
          left: object1.getBoundingClientRect().left + 50,
        };

        const obj = object2.getBoundingClientRect();

        return !(
          char.bottom < obj.top ||
          char.top > obj.bottom ||
          char.right < obj.left ||
          char.left > obj.right
        );
      }

      ///////////////ê²Œì„í´ë¦¬ì–´ ì¡°ê±´
      function checkGameClear() {
        setInterval(function () {
          // console.log(score);
          // console.log(score > 100);
          if (score > 300) {
            // alert("ê²Œì„ í´ë¦¬ì–´!");
            // food.fadeOut(3000)
            // toAvoid.fadeOut;

            //í•˜ë¦¬ ì ë“  ì‚¬ì§„, ì‚°ì±… ë!
            // $("#gameclear_screen").show();
            // contents.css.transition = "all 2s";
            // alert("ì‚°ì±… ì™„ë£Œ!");
            clearInterval(this);
          }
        }, 1000 / 60);
      }

      /////////////////////ê²Œì„ì˜¤ë²„ ì¡°ê±´
      function checkGameOver() {
        const isGameOver = false;
        setInterval(function () {
          if (score <= -500) {
            hari.stop();
            food.stop();
            goose.stop();
            $("#gameover_screen").show();
            //í™•ì¸ìš©
            $('#startScreen').hide();
            isGameOver = true;
          }
        });
      }

      // ì í”„ ì¤‘ì¸ì§€?
      let isJumping = false;

      // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì •ì˜
      function setKeyboardEvent() {
        $("html").keydown(function (e) {
          switch (e.key) {
            case "ArrowLeft":
            case "A":
            case "a":
              moveLeft();
              break;
            case "ArrowRight":
            case "D":
            case "d":
              moveRight();
              break;
            case " ": //spacebar
              if (!isJumping) {
                jump();
              }
              break;
            // spacebar ì…ë ¥ì‹œ ì¹œêµ¬í˜¸ì¶œã…‹ã…‹
            case "F":
            case "f":
              callBunny();
              break;
            case "R":
            case "r":
              retry();
              break;
          }
          console.log(e.key);
        });

        function moveLeft() {
          hari.animate({ left: "-=10px" }, 0);
          if (hari.position().left < 0) {
            hari.animate({ left: "+=10px" }, 0);
          }
          //ì™¼ìª½ë²½ì— ë‹¿ëŠ”ì§€
          const hariLeftMargin = hari.position().left;
          if (hariLeftMargin < 30) {
            hari.animate({ left: "+=10px" }, 0);
          }
        }
        function moveRight() {
          hari.animate({ left: "+=10px" }, 0);
          //1ë²ˆ
          if (hari.position().left > 450) {
            hari.animate({ left: "-=10px" }, 0);
          }
          //ì˜¤ë¥¸ìª½ í•œê³„
          const hariRightMargin = hari.position().left;
          if (hariRightMargin > container.width() - hari.width()) {
            hari.animate({ left: "-=10px" }, 0);
          }
        }
        function jump() {
          isJumping = true;
          hari
            .animate({ bottom: "+=100px" }, 300)
            .animate({ bottom: "-=100px" }, 1200, function () {
              isJumping = false;
            }); //í•©ì³ì¤¬ìŒ
        }




        // í•„ì‚´ê¸°, ì¹œêµ¬ ë¶€ë¥´ê¸°
        function callBunny() {
          //bunny = $("#rabbit"); ì´ê±´ ì•ˆë˜ê³ ...
          let bunny = $("#rabbit");
          const initialPosition = bunny.position().left;

          bunny.animate(
            { left: "+=300px" },
            //ìˆ«ì ë‚®ìœ¼ë©´ ë¹ ë¥´ê³ , ë†’ìœ¼ë©´ ëŠë ¤ì§
            300,
            "linear",
            function () {
              bunny.css("transform", "scaleX(-1)");
              bunny.animate(
                { left: initialPosition + "px" },
                1000,
                "linear",
                function () {
                  bunny.css("transform", "none");
                }
              )
            })
            killGoose();
        }
        // const fox = document.querySelector("#fox");
        // const bunny = document.querySelector("#rabbit");
        // const goose = document.querySelector("#goose");

        //í† ë¼ì˜ ê±°ìœ„ì¡ê¸°
        function killGoose() {
          const bunnyRect = bunny.getBoundingClientRect();
          const gooseRect = goose.getBoundingClientRect();

          if (bunnyRect.x + bunnyRect.width > gooseRect.x) {
            // alert("ê±°ìœ„ë¥¼ ì¡ì•˜ë‹¤!");
            goose.css.hide();
          }
        }

        setInterval(killGoose, 1000 / 60);
      }
      // });




      ///////////ë‹¤ì‹œí•˜ê¸°
      function retry() {
        $("#gameover_screen").hide();
        count = 3;
        // contents.position(defaultPosition);
        // gameStart();

      }






    }); //ready í•¨ìˆ˜ ë






    // $('#gameover_screen input[type="button"]').click(function () {
    // $('#retryButton').click(function () {
    //   $("#gameover_screen").hide(); // ê²Œì„ ì˜¤ë²„ í™”ë©´ ìˆ¨ê¹€
    //   gameStart(); // ê²Œì„ ì¬ì‹œì‘
    // });


  </script>
</head>









<body>
  <!-- <span id="title">í•˜ë¦¬ì˜ ì‚°ì±…</span> -->
  <!-- <span id="title"
      >í•˜ë¦¬ê°€ ë¯¸ì¹œ ê±°ìœ„ë¥¼ í”¼í•´ <br />
      ì•ˆì „í•˜ê²Œ ì‚°ì±…ì„ ë§ˆì¹˜ê³  <br />ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”!</span
    > -->
  <div id="container">
    <div id="intro">
      <div id="startScreen">
        <span id="titleName">í•˜ë¦¬ì˜ í‰í™”ë¡œìš´ ì‚°ì±…</span>
        <span id="titleEngName">Hari's peaceful walk</span>

        <span id="titleText">
          ëª©í‘œì ìˆ˜ 1000ì ì„ ëª¨ì•„ì„œ <br />
          í•˜ë¦¬ğŸ•ê°€ ì´ìƒí•œ ê±°ìœ„ğŸ”ªë¥¼ í”¼í•´ <br />
          ì§‘ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”! <br />
        </span>
        <button id="startButton" onclick="clickButton()">ì‹œì‘í•˜ê¸°</button>
      </div>
      <div id="countdown">3</div>
    </div>


    <div id="contents">
      <div>
        <img id="hari" src="src/walking-hari.gif" alt="" />
        <img class="friend" id="fox" src="src/fox.gif" alt="" />
        <img class="friend" id="rabbit" src="src/rabbit.gif" alt="" />
      </div>

      <!-- <span class="food" id="yammy">í•˜ë¦¬ì•¼ğŸ’•</span> -->
      <img class="food" id="bone" src="src/bone.png" alt="" />
      <img class="toAvoid" id="goose" src="src/goose.gif" alt="" />
      <img id="star" src="src/star.gif" alt="">
      <div id="score">000ì </div>
    </div>


    <div id="gameover_screen">
      <span id="gameover_msg">
        <ì‚°ì±… ì‹¤íŒ¨ğŸ˜¥><br>ğŸ’¡ê²Œì„ì„ í´ë¦¬ì–´í•˜ë©´ ì§„ì§œ í•˜ë¦¬ë¥¼ ë§Œë‚  ìˆ˜ ìˆì–´ìš”!
      </span> <br>
      <button id="retryButton" onclick="window.location.reload();">ë‹¤ì‹œ ë„ì „í•˜ê¸°[R]</button>
      <!-- <button id="retryButton" onclick="$().gameStart()">ë‹¤ì‹œ ë„ì „í•˜ê¸°[R]</button> -->
    </div>

    <div id="guide">
      ì´ë™ : Aâ—€ â–¶D&nbsp&nbsp&nbspì í”„ : [spacebar]&nbsp&nbsp&nbspğŸ‡ : F
    </div>
  </div>
</body>

</html>